(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/money/pay"],{"5c4f":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},a=[];n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a})},"6fd7":function(e,t,n){"use strict";n.r(t);var o=n("5c4f"),a=n("8559");for(var r in a)"default"!==r&&function(e){n.d(t,e,function(){return a[e]})}(r);n("a981");var i=n("2877"),c=Object(i["a"])(a["default"],o["a"],o["b"],!1,null,null,null);t["default"]=c.exports},8559:function(e,t,n){"use strict";n.r(t);var o=n("e18a"),a=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);t["default"]=a.a},a981:function(e,t,n){"use strict";var o=n("b11e"),a=n.n(o);a.a},b11e:function(e,t,n){},e18a:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("a34a"));function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n,o,a,r,i){try{var c=e[r](i),s=c.value}catch(d){return void n(d)}c.done?t(s):Promise.resolve(s).then(o,a)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function c(e){r(i,o,a,c,s,"next",e)}function s(e){r(i,o,a,c,s,"throw",e)}c(void 0)})}}var c={data:function(){return{payType:1,orderInfo:{},miao:10800,datetime:{shi:"03",fen:"00",miao:"00"},id:""}},computed:{},onLoad:function(t){var n=e.getStorageSync("cbe_token");if(n)this.id=t.ordersn,this.getOrder(t.ordersn);else{e.showToast({title:"未登录或无权限",icon:"none"});setTimeout(function(){e.navigateBack({delta:1})},1e3)}},methods:{aatime:function(e){var t=this;this.timer=setInterval(function(){e-=1,e>0?t.getTime(e):t.quxiaoOrder(t.id)},1e3)},getTime:function(e){var t=Math.ceil(e/3600)-1,n=Math.ceil(e/60)-1-60*t,o=e-60*t*60-60*n-1;this.datetime.shi=t<"10"?"0"+t:t,this.datetime.fen=n<"10"?"0"+n:n,this.datetime.miao=o<"10"?"0"+o:o},getOrder:function(t){var n=this;e.showLoading({title:"加载中",mask:!0}),e.request({url:e.getStorageSync("hostname")+"?action=index/order/order_detail",data:{id:t,token:e.getStorageSync("cbe_token")},method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(o){e.hideLoading();var a=o.data;0==a.code&&(n.orderInfo=a.data,a.data.cha>0?n.aatime(a.data.cha):n.quxiaoOrder(t))},fail:function(t){e.hideLoading()}})},quxiaoOrder:function(t){0==this.orderInfo.status&&e.request({url:e.getStorageSync("hostname")+"?action=index/order/order_quxiao",data:{id:t,token:e.getStorageSync("cbe_token")},method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(n){var o=n.data;0==o.code&&(e.showToast({title:"订单超时取消",icon:"none"}),e.redirectTo({url:"/pages/money/payError?errortype=cancle&ordersn="+t}))}})},changePayType:function(e){this.payType=e},checkpay:function(){e.showLoading({title:"等待支付结果"});var t=this;e.request({url:e.getStorageSync("hostname")+"?action=index/pay/checkpay",data:{ordersn:t.orderInfo.ordersn},method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(n){if(0==n.data.code){e.hideLoading();setTimeout(function(){e.redirectTo({url:"/pages/money/paySuccess?ordersn="+t.orderInfo.ordersn})},100)}}})},confirm:function(){var t=i(o.default.mark(function t(n){var a,r;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:a=this,1==this.payType&&(r="wechat_mp","getUserInfo:ok"==n.detail.errMsg?(e.showLoading({title:"正在授权",mask:!0}),e.login({provider:"weixin",success:function(t){if("login:ok"==t.errMsg){t.code;e.getUserInfo({provider:"weixin",lang:"zh_CN",success:function(n){n=JSON.stringify(n);e.request({url:e.getStorageSync("hostname")+"?action=index/pay/index",data:{types:r,token:e.getStorageSync("cbe_token"),ordersn:a.orderInfo.ordersn,code:t.code,infoRes:n},method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){if(0==t.data.code){var n=t.data.data;e.requestPayment({provider:"wxpay",timeStamp:n.timeStamp,nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign,success:function(e){a.checkpay()},fail:function(t){e.redirectTo({url:"/pages/money/payError?ordersn="+a.orderInfo.ordersn})}})}else a.checkpay()},fail:function(t){e.showToast({title:"授权失败，请稍候再试",icon:"none"})}})},fail:function(t){e.showToast({title:"授权失败，请稍候再试",icon:"none"})}})}else e.showToast({title:"授权失败，请稍候再试",icon:"none"})},fail:function(t){e.showToast({title:"授权失败，请稍候再试",icon:"none"})}})):e.showToast({title:"无权限支付，请先授权",icon:"none"}));case 2:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}()}};t.default=c}).call(this,n("543d")["default"])},ea25:function(e,t,n){"use strict";(function(e){n("7086"),n("921b");o(n("66fd"));var t=o(n("6fd7"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])}},[["ea25","common/runtime","common/vendor"]]]);