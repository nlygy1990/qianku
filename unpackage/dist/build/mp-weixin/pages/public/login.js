(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/public/login"],{"1d57":function(e,t,n){},"7aad":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("a34a")),i=n("2f62");function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,o,i,a,s){try{var r=e[a](s),c=r.value}catch(u){return void n(u)}r.done?t(c):Promise.resolve(c).then(o,i)}function r(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function r(e){s(a,o,i,r,c,"next",e)}function c(e){s(a,o,i,r,c,"throw",e)}r(void 0)})}}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){u(e,t,n[t])})}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d={data:function(){return{username:"",password:"",showPassword:!0,mobile:"",imgcode:"",imgyzcode:"",phonecode:"",phonetoken:"",scode:!1,getcode:"获取验证码",logining:!1,index:1,width:70,height:30}},onLoad:function(t){var n=this;setTimeout(function(){n.init()},100),e.removeStorageSync("cbe_retoken"),e.removeStorageSync("cbe_token"),t.code&&this.getWxuserinfo(t.code)},onShow:function(){e.getStorageSync("cbe_token")&&e.switchTab({url:"/pages/index/index"}),e.removeStorageSync("cbe_retoken"),this.init()},methods:c({},(0,i.mapMutations)(["login"]),{inputChange:function(e){var t=e.currentTarget.dataset.key;this[t]=e.detail.value},changePassword:function(){this.showPassword=!this.showPassword},changeLogin:function(e){this.index=e,this.init()},navBack:function(){e.navigateBack({delta:1})},toRegist:function(){e.navigateTo({url:"zhecexieyi"})},toForget:function(){e.navigateTo({url:"forget"})},wechatLogin:function(){},randomNum:function(e,t){switch(arguments.length){case 1:return parseInt(Math.random()*e+1,10);case 2:return parseInt(Math.random()*(t-e+1)+e,10);default:return 0}},getWxuserinfo:function(t){var n=this;e.showLoading({title:"正在处理",mask:!0});var o=this;e.request({url:e.getStorageSync("hostname")+"?action=index/login/wxjsapiLogin",data:{code:t},method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.hideLoading();var i=t.data;if(0==i.code){e.setStorageSync("cbe_token",i.token),e.showToast({title:i.msg,icon:"success",mask:!0,duration:3e3}),o.login(i.data);setTimeout(function(){e.switchTab({url:"/pages/user/user"})},3e3)}else if(1==i.code){e.setStorageSync("cbe_retoken",i.token),e.showToast({title:i.msg,icon:"success",mask:!0,duration:3e3});setTimeout(function(){e.navigateTo({url:"dsflogin"})},2e3)}else e.showToast({title:i.msg,icon:"none"}),n.logining=!1}})},getuserinfo:function(t){var n=this;"getUserInfo:ok"==t.detail.errMsg&&(e.showLoading({title:"正在授权",mask:!0}),e.login({provider:"weixin",success:function(t){if("login:ok"==t.errMsg){var o=t.code;e.getUserInfo({provider:"weixin",lang:"zh_CN",success:function(t){var i=this;e.request({url:e.getStorageSync("hostname")+"?action=index/login/wechatlogin&code="+o,data:t,method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.hideLoading();var o=t.data;if(0==o.code){e.setStorageSync("cbe_token",o.token),e.showToast({title:o.msg,icon:"success",mask:!0,duration:3e3}),n.login(o.data);setTimeout(function(){e.navigateBack({delta:1})},3e3)}else if(1==o.code){e.setStorageSync("cbe_retoken",o.token),e.showToast({title:o.msg,icon:"success",mask:!0,duration:3e3});setTimeout(function(){e.navigateTo({url:"/pages/public/zhecexieyi"})},2e3)}else e.showToast({title:o.msg,icon:"none"}),i.logining=!1}})}})}}}))},toLogin:function(){var t=r(o.default.mark(function t(){var n,i=this;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.logining=!0,0!=this.index){t.next=14;break}if(this.username){t.next=6;break}return e.showToast({title:"手机号码/账号不能为空",icon:"none"}),this.logining=!1,t.abrupt("return",!1);case 6:if(this.password){t.next=10;break}return e.showToast({title:"密码不能为空",icon:"none"}),this.logining=!1,t.abrupt("return",!1);case 10:e.showLoading({title:"正在登录",mask:!0}),e.request({url:e.getStorageSync("hostname")+"?action=index/login/pwdlogin",data:{username:this.username,password:this.password},method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.hideLoading();var n=t.data;if(0==n.code){e.setStorageSync("cbe_token",n.token),i.phonetoken="",e.showToast({title:n.msg,icon:"success",mask:!0,duration:3e3}),i.login(n.data);setTimeout(function(){e.navigateBack({delta:1})},3e3)}else e.showToast({title:n.msg,icon:"none"}),i.logining=!1}}),t.next=41;break;case 14:if(n=/^1[0-9]{10,10}$/,this.mobile){t.next=21;break}return e.showToast({title:"手机号码不能为空",icon:"none"}),this.logining=!1,t.abrupt("return",!1);case 21:if(n.test(this.mobile)){t.next=25;break}return e.showToast({title:"手机号码格式错误",icon:"none"}),this.logining=!1,t.abrupt("return",!1);case 25:if(this.imgcode){t.next=31;break}return e.showToast({title:"图形验证码不能为空",icon:"none"}),this.logining=!1,t.abrupt("return",!1);case 31:if(this.imgcode==this.imgyzcode){t.next=35;break}return e.showToast({title:"图形验证码错误",icon:"none"}),this.logining=!1,t.abrupt("return",!1);case 35:if(this.phonecode){t.next=39;break}return e.showToast({title:"手机验证码不能为空",icon:"none"}),this.logining=!1,t.abrupt("return",!1);case 39:e.showLoading({title:"正在登录",mask:!0}),e.request({url:e.getStorageSync("hostname")+"?action=index/login/phonelogin",data:{phone:this.mobile,imgcode:this.imgcode,code:this.phonecode,token:this.phonetoken},method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.hideLoading();var n=t.data;if(0==n.code){e.setStorageSync("cbe_token",n.token),i.phonetoken="",e.showToast({title:n.msg,icon:"success",mask:!0,duration:3e3}),i.login(n.data);setTimeout(function(){e.navigateBack({delta:1})},3e3)}else e.showToast({title:n.msg,icon:"none"}),i.logining=!1}});case 41:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),getPhoneCode:function(t){var n=this;if(0==this.scode){var o=/^1[0-9]{10,10}$/;if(o.test(this.mobile)){if(!this.imgcode)return e.showToast({title:"图形验证码不能为空",icon:"none"}),!1;if(this.imgcode!=this.imgyzcode)return e.showToast({title:"图形验证码错误",icon:"none"}),this.logining=!1,!1;var i=120;this.scode=!0,this.timer=setInterval(function(){i-=1,"0"==i?(n.getcode="获取验证码",i=120,n.scode=!1,clearInterval(n.timer)):n.getcode="重新获取("+i+"s)"},1e3),e.showLoading({title:"正在获取",mask:!0}),e.request({url:e.getStorageSync("hostname")+"?action=index/common/getphonecode",data:{phone:this.mobile,use:"login"},method:"POST",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.hideLoading();var o=t.data;0==o.code?(console.log(o.msg),e.showToast({title:o.msg,icon:"success",mask:!0,duration:3e3}),n.phonetoken=o.token,n.index=1):(e.showToast({title:o.msg,icon:"none"}),n.getcode="获取验证码",i=120,n.scode=!1,clearInterval(n.timer))},fail:function(t){e.showToast({title:"网络连接超时，请检查您的网络",icon:"none"});setTimeout(function(){n.getcode="获取验证码",i=120,n.scode=!1,clearInterval(n.timer)},1e3)}})}else e.showToast({title:"手机号码格式错误",icon:"none"})}},init:function(){var t=r(o.default.mark(function t(){var n,i,a,s,r,c,u,d,l;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:n=e.createCanvasContext("imgcanvas",this),i=this.width,a=this.height,n.setFillStyle("white"),n.setLineWidth(5),n.fillRect(0,0,i,a),s=["A","B","C","D","E","F","G","H","J","K","L","M","N","P","Q","R","S","T","U","V","W","S","Y","Z","1","2","3","4","5","6","7","8","9","0"],r="",c=0;case 6:if(!(c<4)){t.next=24;break}return u=s[this.rn(0,s.length)],d=this.rn(-30,30),n.setFontSize(18),n.setTextBaseline("top"),t.next=13,this.rc(80,150);case 13:l=t.sent,n.setFillStyle(l),n.save(),n.translate(15*c+15,parseInt(a/1.5)),n.rotate(d*Math.PI/180),n.fillText(u,-10,-15),n.restore(),r+=u;case 21:c++,t.next=6;break;case 24:for(e.setStorage({key:"imgcode",data:r}),this.imgyzcode=r,c=0;c<40;c++)n.beginPath(),n.arc(this.rn(0,i),this.rn(0,a),1,0,2*Math.PI),n.closePath(),n.setFillStyle(this.rc(150,200)),n.fill();n.draw();case 28:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),rc:function(){var e=r(o.default.mark(function e(t,n){var i=this;return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,o){var a=i.rn(t,n),s=i.rn(t,n),r=i.rn(t,n);e("rgb("+a+","+s+","+r+")")}));case 1:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),rn:function(e,t){return parseInt(Math.random()*(e-t))+t},refresh:function(){this.init()},canvasIdErrorCallback:function(e){console.error(e.detail.errMsg)}})};t.default=d}).call(this,n("543d")["default"])},"7d93":function(e,t,n){"use strict";var o=n("1d57"),i=n.n(o);i.a},8972:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i})},9148:function(e,t,n){"use strict";(function(e){n("7086"),n("921b");o(n("66fd"));var t=o(n("ddc2"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},d7e1:function(e,t,n){"use strict";n.r(t);var o=n("7aad"),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,function(){return o[e]})}(a);t["default"]=i.a},ddc2:function(e,t,n){"use strict";n.r(t);var o=n("8972"),i=n("d7e1");for(var a in i)"default"!==a&&function(e){n.d(t,e,function(){return i[e]})}(a);n("7d93");var s=n("2877"),r=Object(s["a"])(i["default"],o["a"],o["b"],!1,null,null,null);t["default"]=r.exports}},[["9148","common/runtime","common/vendor"]]]);